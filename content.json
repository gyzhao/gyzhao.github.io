{"posts":[{"title":"Promise å’Œ async &amp; await","text":"å¼‚æ­¥æ˜¯ä¸ºäº†ä¼˜åŒ–éœ€è¦é•¿æ—¶é—´æ“ä½œã€‚å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯ä½¿ä½ çš„ç¨‹åºå¯ä»¥åœ¨æ‰§è¡Œä¸€ä¸ªå¯èƒ½é•¿æœŸè¿è¡Œçš„ä»»åŠ¡çš„åŒæ—¶ç»§ç»­å¯¹å…¶ä»–äº‹ä»¶åšå‡ºååº”è€Œä¸å¿…ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚ å›è°ƒå‡½æ•°å›è°ƒå‡½æ•°è¡¨æ˜å¼‚æ­¥æ“ä½œå·²ç»å®Œæˆã€‚ä½œä¸ºæ›¾ç» JavaScript ä¸­å®ç°å¼‚æ­¥å‡½æ•°çš„ä¸»è¦æ–¹å¼ã€‚ä¸»è¦å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªä¸è¶³ï¼š é”™è¯¯å¤„ç†å›°éš¾ï¼šå½“ä»»åŠ¡é•¿æœŸè¿è¡Œï¼Œè°ƒç”¨å›è°ƒå‡½æ•°çš„ä»£ç ä¸€èˆ¬ä¸ä¼šå’Œå¼€å§‹ä»»åŠ¡ä¸­çš„åŒæ­¥ä»£ç ä½äºåŒä¸€äº‹ä»¶å¾ªç¯å‘¨æœŸ è¿ç»­æ‰§è¡Œæ­¥éª¤éå¸¸æ£˜æ‰‹ï¼šä¹Ÿå°±æ˜¯å›è°ƒåœ°ç‹±çš„é—®é¢˜ æ‰§è¡Œå¹¶è¡Œä»»åŠ¡æ—¶ä¹Ÿæœ‰ä¸€å®šå¤æ‚åº¦ å½“å¼‚æ­¥è¯·æ±‚ç›¸äº’ä¾èµ–æ—¶ä½¿ç”¨å›è°ƒçš„æ–¹å¼ä¼šå¯¼è‡´æ·±åº¦åµŒå¥—ï¼Œä¼šå¯¼è‡´ç»å…¸çš„å›è°ƒåœ°ç‹±ï¼š 1234567doSomething(function(result) { doSomethingElse(result, function(newResult) { doThirdThing(newResult, function(finalResult) { console.log('Got the final result: ' + finalResult); }, failureCallback); }, failureCallback);}, failureCallback); PromisePromise æ˜¯ç°åœ¨ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ã€‚**Promise** å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æœå€¼ã€‚ Promises/A+ è§„èŒƒPromise ä½œä¸ºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒç”±ç¤¾åŒºæœ€æ—©æå‡ºå’Œå®ç°ã€‚ES6 å¢åŠ äº†å¯¹ Promises/A+ è§„èŒƒçš„å®Œå–„æ”¯æŒï¼Œå°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†Promiseå¯¹è±¡ã€‚ Promise åŸºç¡€Promise æœ‰ä¸‹é¢ä¸‰ç§çŠ¶æ€ï¼š å¾…å®šï¼ˆpendingï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚ å·²å…‘ç°ï¼ˆ fulfilled ï¼‰ ï¼šæ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚ å·²æ‹’ç»ï¼ˆ rejected ï¼‰ ï¼šæ„å‘³ç€æ“ä½œå¤±è´¥ã€‚ å¾…å®šçŠ¶æ€çš„ Promise å¯¹è±¡è¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªå€¼è¢«å…‘ç°ï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªåŸå› ï¼ˆé”™è¯¯ï¼‰ è¢«æ‹’ç» ã€‚å½“è¿™äº›æƒ…å†µä¹‹ä¸€å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ç”¨ promise çš„ then æ–¹æ³•æ’åˆ—èµ·æ¥çš„ç›¸å…³å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚ä¸”è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œä¸€ä¸ª promise åªèƒ½æˆåŠŸæˆ–å¤±è´¥ä¸€æ¬¡ã€‚ Promise çš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œè€Œä¸”çŠ¶æ€ä¹Ÿä¸èƒ½è¢«å¤–éƒ¨ä»£ç ä¿®æ”¹ã€‚Promise ç‰¹æ„å°†å¼‚æ­¥è¡Œä¸ºå°è£…èµ·æ¥ï¼Œä»è€Œéš”ç¦»å¤–éƒ¨çš„åŒæ­¥ä»£ç ã€‚ ä½¿ç”¨Promise æœ‰ä»¥ä¸‹çº¦å®šï¼š åœ¨æœ¬è½® äº‹ä»¶å¾ªç¯ è¿è¡Œå®Œæˆä¹‹å‰ï¼Œå›è°ƒå‡½æ•°æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ã€‚ å³ä½¿å¼‚æ­¥æ“ä½œå·²ç»å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œåœ¨è¿™ä¹‹åé€šè¿‡ then() æ·»åŠ çš„å›è°ƒå‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ é€šè¿‡å¤šæ¬¡è°ƒç”¨ then() å¯ä»¥æ·»åŠ å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡Œæ‰§è¡Œã€‚ Promise() æ„é€ å™¨Promise æ„é€ å™¨ä¸»è¦ç”¨äºåŒ…è£…ä¸æ”¯æŒ promiseï¼ˆè¿”å›å€¼ä¸æ˜¯ Promiseï¼‰çš„å‡½æ•°ã€‚æ„é€ å™¨æ¥å—ä¸€ä¸ªåä¸º â€œ executor function â€œ çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åº”å½“æ¥å—ä¸¤ä¸ªå‡½æ•°å‚æ•°ã€‚å½“å¼‚æ­¥ä»»åŠ¡æˆåŠŸæ—¶ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼ˆresolveï¼‰å°†è¢«è°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»£è¡¨æˆåŠŸã€‚å½“å…¶å¤±è´¥æ—¶ï¼Œç¬¬äºŒä¸ªå‡½æ•°ï¼ˆrejectï¼‰å°†è¢«è°ƒç”¨ï¼Œå¹¶è¿”å›å¤±è´¥åŸå› ï¼ˆå¤±è´¥åŸå› é€šå¸¸æ˜¯ä¸€ä¸ª error å¯¹è±¡ï¼‰ã€‚è¯­æ³•å¦‚ä¸‹ï¼š 1new Promise(executor) ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š 123456const await = (ws) =&gt; new Promise((resolve, reject) =&gt; { if (typeof ws !== 'number') { reject(Error('ws must be a number.')); } setTimeout(resolve, ws);}); Promise çš„å®ä¾‹æ–¹æ³•ä¸‹é¢çš„æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œæ‰€ä»¥éƒ½æ˜¯å¯ä»¥è¢« é“¾å¼è°ƒç”¨ ï¼ˆ chaining ï¼‰ã€‚ Promise.prototype.thenä¸º promise æ·»åŠ è¢«å…‘ç°å’Œè¢«æ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä»¥å›è°ƒå‡½æ•°çš„è¿”å›å€¼å…‘ç° promise Promise.prototype.catchè¢«æ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè‹¥å›è°ƒå‡½æ•°è¢«è°ƒç”¨ï¼Œåˆ™å…‘ç°å…¶è¿”å›å€¼ï¼Œå¦åˆ™å…‘ç°åŸæ¥çš„ promise å…‘ç°çš„å€¼ Promise.prototype.finally()å°†åœ¨åŸ promise è¢«æ•²å®šï¼ˆæ— è®ºè¢«å…‘ç°è¿˜æ˜¯è¢«æ‹’ç»ï¼‰æ—¶è¢«è°ƒç”¨ catch(failureCallback) æ˜¯ then(null, failureCallback) çš„ç¼©ç•¥å½¢å¼ã€‚ä¸€é‡åˆ°å¼‚å¸¸æŠ›å‡ºï¼Œæµè§ˆå™¨å°±ä¼šé¡ºç€ Promise é“¾å¯»æ‰¾ä¸‹ä¸€ä¸ª onRejected å¤±è´¥å›è°ƒå‡½æ•°æˆ–è€…ç”± .catch() æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚onRejected å¤„ç†ç¨‹åºè¿”å›çš„å€¼ä¹Ÿä¼šè¢« Promise.resolve() åŒ…è£…ã€‚ é™æ€æ–¹æ³•Promise.resolve() å’Œ Promise.reject() æ˜¯æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå·²ç» resolve æˆ–è€… reject çš„ Promise å¿«æ·æ–¹æ³•ã€‚ Promise.all() å’Œ Promise.race() æ˜¯å¹¶è¡Œè¿è¡Œå¼‚æ­¥æ“ä½œçš„ä¸¤ä¸ªç»„åˆå¼å·¥å…·ã€‚ Promise æ‰©å±•ES6 çš„ Promise å®ç°æœ‰ä¸¤ä¸ªç‰¹æ€§å¹¶æ²¡æœ‰å®ç°ï¼šPromise å–æ¶ˆå’Œè¿›åº¦è·Ÿè¸ªã€‚ async/awaitå¼‚æ­¥æ–¹æ³•å¹¶ä¸ä¼šç«‹å³è¿”å›æœ€ç»ˆçš„å€¼ï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ª promise ï¼Œä»¥ä¾¿åœ¨æœªæ¥æŸä¸ªæ—¶å€™æŠŠå€¼äº¤ç»™ä½¿ç”¨è€…ã€‚ asyncå’Œawaitå…³é”®å­—è®©æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼å†™å‡ºåŸºäºPromiseçš„å¼‚æ­¥è¡Œä¸ºï¼Œè€Œæ— éœ€åˆ»æ„åœ°é“¾å¼è°ƒç”¨promise async å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚è¿™ä¸ª promise è¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªç”± async å‡½æ•°è¿”å›çš„å€¼è¢«è§£å†³ï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªä» async å‡½æ•°ä¸­æŠ›å‡ºçš„ï¼ˆæˆ–å…¶ä¸­æ²¡æœ‰è¢«æ•è·åˆ°çš„ï¼‰å¼‚å¸¸è¢«æ‹’ç»ã€‚ await æ“ä½œç¬¦ç”¨äºç­‰å¾…ä¸€ä¸ªPromise å¯¹è±¡ã€‚å®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•° async function ä¸­ä½¿ç”¨ã€‚ å‚è€ƒPromise å’Œ async/awaitå¼‚æ­¥æ˜¯ä¸ºäº†ä¼˜åŒ–éœ€è¦é•¿æ—¶é—´æ“ä½œã€‚å¼‚æ­¥ç¼–ç¨‹æŠ€æœ¯ä½¿ä½ çš„ç¨‹åºå¯ä»¥åœ¨æ‰§è¡Œä¸€ä¸ªå¯èƒ½é•¿æœŸè¿è¡Œçš„ä»»åŠ¡çš„åŒæ—¶ç»§ç»­å¯¹å…¶ä»–äº‹ä»¶åšå‡ºååº”è€Œä¸å¿…ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚ å›è°ƒå‡½æ•°å›è°ƒå‡½æ•°è¡¨æ˜å¼‚æ­¥æ“ä½œå·²ç»å®Œæˆã€‚ä½œä¸ºæ›¾ç» JavaScript ä¸­å®ç°å¼‚æ­¥å‡½æ•°çš„ä¸»è¦æ–¹å¼ã€‚ä¸»è¦å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªä¸è¶³ï¼š é”™è¯¯å¤„ç†å›°éš¾ï¼šå½“ä»»åŠ¡é•¿æœŸè¿è¡Œï¼Œè°ƒç”¨å›è°ƒå‡½æ•°çš„ä»£ç ä¸€èˆ¬ä¸ä¼šå’Œå¼€å§‹ä»»åŠ¡ä¸­çš„åŒæ­¥ä»£ç ä½äºåŒä¸€äº‹ä»¶å¾ªç¯å‘¨æœŸ è¿ç»­æ‰§è¡Œæ­¥éª¤éå¸¸æ£˜æ‰‹ï¼šä¹Ÿå°±æ˜¯å›è°ƒåœ°ç‹±çš„é—®é¢˜ æ‰§è¡Œå¹¶è¡Œä»»åŠ¡æ—¶ä¹Ÿæœ‰ä¸€å®šå¤æ‚åº¦ å½“å¼‚æ­¥è¯·æ±‚ç›¸äº’ä¾èµ–æ—¶ä½¿ç”¨å›è°ƒçš„æ–¹å¼ä¼šå¯¼è‡´æ·±åº¦åµŒå¥—ï¼Œä¼šå¯¼è‡´ç»å…¸çš„å›è°ƒåœ°ç‹±ï¼š 1234567doSomething(function(result) { doSomethingElse(result, function(newResult) { doThirdThing(newResult, function(finalResult) { console.log('Got the final result: ' + finalResult); }, failureCallback); }, failureCallback);}, failureCallback); PromisePromise æ˜¯ç°åœ¨ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ã€‚**** å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æœå€¼ã€‚ Promises/A+ è§„èŒƒPromise ä½œä¸ºå¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®ƒç”±ç¤¾åŒºæœ€æ—©æå‡ºå’Œå®ç°ã€‚ES6 å¢åŠ äº†å¯¹ Promises/A+ è§„èŒƒçš„å®Œå–„æ”¯æŒï¼Œå°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€äº†ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº†Promiseå¯¹è±¡ã€‚ Promise åŸºç¡€Promise æœ‰ä¸‹é¢ä¸‰ç§çŠ¶æ€ï¼š å¾…å®šï¼ˆpendingï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚ å·²å…‘ç°ï¼ˆ**ï¼‰ï¼šæ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚ å·²æ‹’ç»ï¼ˆ**ï¼‰ï¼šæ„å‘³ç€æ“ä½œå¤±è´¥ã€‚ å¾…å®šçŠ¶æ€çš„ Promise å¯¹è±¡è¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªå€¼è¢«å…‘ç°ï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªåŸå› ï¼ˆé”™è¯¯ï¼‰è¢«æ‹’ç»ã€‚å½“è¿™äº›æƒ…å†µä¹‹ä¸€å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ç”¨ promise çš„ then æ–¹æ³•æ’åˆ—èµ·æ¥çš„ç›¸å…³å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚ä¸”è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œä¸€ä¸ª promise åªèƒ½æˆåŠŸæˆ–å¤±è´¥ä¸€æ¬¡ã€‚ ğŸ“ŒPromise çš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œè€Œä¸”çŠ¶æ€ä¹Ÿä¸èƒ½è¢«å¤–éƒ¨ä»£ç ä¿®æ”¹ã€‚Promise ç‰¹æ„å°†å¼‚æ­¥è¡Œä¸ºå°è£…èµ·æ¥ï¼Œä»è€Œéš”ç¦»å¤–éƒ¨çš„åŒæ­¥ä»£ç ã€‚ ä½¿ç”¨Promise æœ‰ä»¥ä¸‹çº¦å®šï¼š åœ¨æœ¬è½® äº‹ä»¶å¾ªç¯ è¿è¡Œå®Œæˆä¹‹å‰ï¼Œå›è°ƒå‡½æ•°æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ã€‚ å³ä½¿å¼‚æ­¥æ“ä½œå·²ç»å®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œåœ¨è¿™ä¹‹åé€šè¿‡ then() æ·»åŠ çš„å›è°ƒå‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ é€šè¿‡å¤šæ¬¡è°ƒç”¨ then() å¯ä»¥æ·»åŠ å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡Œæ‰§è¡Œã€‚ Promise() æ„é€ å™¨**** æ„é€ å™¨ä¸»è¦ç”¨äºåŒ…è£…ä¸æ”¯æŒ promiseï¼ˆè¿”å›å€¼ä¸æ˜¯ Promiseï¼‰çš„å‡½æ•°ã€‚æ„é€ å™¨æ¥å—ä¸€ä¸ªåä¸º â€œexecutor functionâ€œ çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åº”å½“æ¥å—ä¸¤ä¸ªå‡½æ•°å‚æ•°ã€‚å½“å¼‚æ­¥ä»»åŠ¡æˆåŠŸæ—¶ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°ï¼ˆresolveï¼‰å°†è¢«è°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»£è¡¨æˆåŠŸã€‚å½“å…¶å¤±è´¥æ—¶ï¼Œç¬¬äºŒä¸ªå‡½æ•°ï¼ˆrejectï¼‰å°†è¢«è°ƒç”¨ï¼Œå¹¶è¿”å›å¤±è´¥åŸå› ï¼ˆå¤±è´¥åŸå› é€šå¸¸æ˜¯ä¸€ä¸ª error å¯¹è±¡ï¼‰ã€‚è¯­æ³•å¦‚ä¸‹ï¼š 1new Promise(executor) ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š 123456const await = (ws) =&gt; new Promise((resolve, reject) =&gt; { if (typeof ws !== 'number') { reject(Error('ws must be a number.')); } setTimeout(resolve, ws);}); Promise çš„å®ä¾‹æ–¹æ³•ä¸‹é¢çš„æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œæ‰€ä»¥éƒ½æ˜¯å¯ä»¥è¢«é“¾å¼è°ƒç”¨ï¼ˆchainingï¼‰ã€‚ Promise.prototype.then&amp;#x20; ä¸º promise æ·»åŠ è¢«å…‘ç°å’Œè¢«æ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œå…¶ä»¥å›è°ƒå‡½æ•°çš„è¿”å›å€¼å…‘ç° promise Promise.prototype.catch è¢«æ‹’ç»çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè‹¥å›è°ƒå‡½æ•°è¢«è°ƒç”¨ï¼Œåˆ™å…‘ç°å…¶è¿”å›å€¼ï¼Œå¦åˆ™å…‘ç°åŸæ¥çš„ promise å…‘ç°çš„å€¼ Promise.prototype.finally() å°†åœ¨åŸ promise è¢«æ•²å®šï¼ˆæ— è®ºè¢«å…‘ç°è¿˜æ˜¯è¢«æ‹’ç»ï¼‰æ—¶è¢«è°ƒç”¨ catch(failureCallback) æ˜¯ then(null, failureCallback) çš„ç¼©ç•¥å½¢å¼ã€‚ä¸€é‡åˆ°å¼‚å¸¸æŠ›å‡ºï¼Œæµè§ˆå™¨å°±ä¼šé¡ºç€ Promise é“¾å¯»æ‰¾ä¸‹ä¸€ä¸ª onRejected å¤±è´¥å›è°ƒå‡½æ•°æˆ–è€…ç”± .catch() æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚onRejected å¤„ç†ç¨‹åºè¿”å›çš„å€¼ä¹Ÿä¼šè¢« Promise.resolve() åŒ…è£…ã€‚ é™æ€æ–¹æ³•Promise.resolve() å’Œ Promise.reject() æ˜¯æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå·²ç» resolve æˆ–è€… reject çš„ Promise å¿«æ·æ–¹æ³•ã€‚ Promise.all() å’Œ Promise.race() æ˜¯å¹¶è¡Œè¿è¡Œå¼‚æ­¥æ“ä½œçš„ä¸¤ä¸ªç»„åˆå¼å·¥å…·ã€‚ Promise æ‰©å±•ES6 çš„ Promise å®ç°æœ‰ä¸¤ä¸ªç‰¹æ€§å¹¶æ²¡æœ‰å®ç°ï¼šPromise å–æ¶ˆå’Œè¿›åº¦è·Ÿè¸ªã€‚ async/awaitå¼‚æ­¥æ–¹æ³•å¹¶ä¸ä¼šç«‹å³è¿”å›æœ€ç»ˆçš„å€¼ï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ª *Promise*ï¼Œä»¥ä¾¿åœ¨æœªæ¥æŸä¸ªæ—¶å€™æŠŠå€¼äº¤ç»™ä½¿ç”¨è€…ã€‚ asyncå’Œawaitå…³é”®å­—è®©æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼å†™å‡ºåŸºäºPromiseçš„å¼‚æ­¥è¡Œä¸ºï¼Œè€Œæ— éœ€åˆ»æ„åœ°é“¾å¼è°ƒç”¨promise async å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ã€‚è¿™ä¸ª promise è¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªç”± async å‡½æ•°è¿”å›çš„å€¼è¢«è§£å†³ï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªä» async å‡½æ•°ä¸­æŠ›å‡ºçš„ï¼ˆæˆ–å…¶ä¸­æ²¡æœ‰è¢«æ•è·åˆ°çš„ï¼‰å¼‚å¸¸è¢«æ‹’ç»ã€‚ await æ“ä½œç¬¦ç”¨äºç­‰å¾…ä¸€ä¸ªPromise å¯¹è±¡ã€‚å®ƒåªèƒ½åœ¨å¼‚æ­¥å‡½æ•° async function ä¸­ä½¿ç”¨ã€‚ å‚è€ƒhttps://book.douban.com/subject/35175321/ https://book.douban.com/subject/30143702/ https://web.dev/i18n/zh/promises/ https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await https://es6.ruanyifeng.com/#docs/promise","link":"/2020/08/09/Promise%20%E5%92%8C%20async%20&%20await/"},{"title":"è¿­ä»£å™¨(Iterators)å’Œç”Ÿæˆå™¨(Generator)","text":"è¿­ä»£å™¨ è¿­ä»£å™¨ï¼ˆiteratorï¼‰ï¼Œä½¿ç”¨æˆ·å¯åœ¨å®¹å™¨å¯¹è±¡ï¼ˆcontainerï¼Œä¾‹å¦‚é“¾è¡¨æˆ–æ•°ç»„ï¼‰ä¸Šéå†çš„å¯¹è±¡ã€‚ è¿­ä»£å™¨æ¨¡å¼è¿­ä»£å™¨æ¨¡å¼å¯ä»¥è®©å¼€å‘è€…æ— éœ€äº†è§£å¦‚ä½•è¿­ä»£å°±å¯ä»¥å®ç°è¿­ä»£æ“ä½œã€‚Pythonï¼ŒC#ï¼ŒJavaå¯¹è¯¥æ¨¡å¼éƒ½æœ‰å®Œå¤‡çš„æ”¯æŒï¼ŒJavaScriptåœ¨ECMAScript 6 ä¹Ÿå°†å…¶å¼•å…¥åˆ°è¯­è¨€æ ¸å¿ƒä¸­æ¥ã€‚ è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯ä»¥ç”±ä»»æ„å¯¹è±¡å®ç°çš„æ¥å£ï¼Œæ”¯æŒè¿ç»­è·å–å¯¹è±¡äº§å‡ºçš„æ¯ä¸€ä¸ªå€¼ã€‚ä»»ä½•å®ç°Iterableæ¥å£çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª Symbol.iterator å±æ€§ï¼Œè¯¥å±æ€§å¼•ç”¨é»˜è®¤è¿­ä»£å™¨ã€‚é»˜è®¤è¿­ä»£å™¨å°±æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè°ƒç”¨åä¼šäº§ç”Ÿä¸€ä¸ªå®ç° Iterator æ¥å£çš„å¯¹è±¡ã€‚è‹¥ä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰è¿­ä»£è¡Œä¸ºè¯¥å¯¹è±¡å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚ å¯è¿­ä»£åè®®(Iterable )å’Œè¿­ä»£å™¨åè®®(Iterator)å®ç°Iterableæ¥å£è¦æ±‚åŒæ—¶å…·å¤‡ä¸¤ç§èƒ½åŠ›ï¼š æ”¯æŒè¿­ä»£è‡ªæˆ‘è¯†åˆ«èƒ½åŠ› å¸¦ Symbol.iterator é”®ï¼ˆkeyï¼‰çš„å±æ€§ï¼Œæš´éœ²è¯¥å±æ€§ä½œä¸ºâ€é»˜è®¤è¿­ä»£å™¨â€œï¼Œå¹¶å¼•ç”¨ä¸€ä¸ªè¿­ä»£å™¨å·¥å‚å‡½æ•° åˆ›å»ºIterator æ¥å£çš„å¯¹è±¡çš„èƒ½åŠ› ä¸€ä¸ªè¿­ä»£å™¨å·¥å‚å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå·¥å‚å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ è¿­ä»£å™¨åè®®ï¼ˆIteratorï¼‰æ˜¯ä¸€ç§ä¸€æ¬¡æ€§ä½¿ç”¨çš„å¯¹è±¡ï¼Œç”¨äºè¿­ä»£ä¸å…¶å…³è”çš„å¯è¿­ä»£å¯¹è±¡ã€‚è¿­ä»£å™¨API ä½¿ç”¨next() æ–¹æ³•å†å¯è¿­ä»£å¯¹è±¡ä¸­éå†æ•°æ®ã€‚ å®ç°äº†Iterableæ¥å£çš„å†…ç½®ç±»å‹ å­—ç¬¦ä¸² æ•°ç»„ æ˜ å°„ é›†åˆ argumentså¯¹è±¡ NodeListç­‰DOMé›†åˆç±»å‹ å¦‚ä»£ç æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031let num = 1;let obj = {};// æ²¡æœ‰å®ç°äº†è¿­ä»£å™¨å·¥å‚å‡½æ•°çš„ç±»å‹console.log(num[Symbol.iterator]); // undefined console.log(obj[Symbol.iterator]); // undefinedlet str = 'banana';;let arr = [1, 2, 3];let map = new Map();let set = new Set();let element = document.querySelectorAll('div');// å®ç°äº†è¿­ä»£å™¨å·¥å‚å‡½æ•°çš„ç±»å‹console.log(str[Symbol.iterator]); // Æ’ [Symbol.iterator]()console.log(arr[Symbol.iterator]); // Æ’ values()console.log(map[Symbol.iterator]); // Æ’ entries()console.log(set[Symbol.iterator]); // Æ’ values()console.log(element[Symbol.iterator]);// Æ’ values()// è°ƒç”¨å·¥å‚å‡½æ•°å°±ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨let strIterator = str[Symbol.iterator]();let arrIterator = arr[Symbol.iterator]();let mapIterator = map[Symbol.iterator]();let setIterator = set[Symbol.iterator]();let elementIterator = element[Symbol.iterator]();console.log(strIterator); // StringIteratorconsole.log(arrIterator); // Array Iteratorconsole.log(mapIterator); // MapIteratorconsole.log(setIterator); //SetIteratorconsole.log(elementIterator); //Array Iterator å¯è¿­ä»£å¯¹è±¡çš„è¯­æ³•å¯¹äºå¯æ¥å—è¿­ä»£å¯¹è±¡çš„åŸç”Ÿè¯­è¨€ç‰¹æ€§è€Œè¨€ï¼Œå®é™…ç¼–ç è¿‡ç¨‹ä¸­ä¸éœ€è¦æ˜¾å¼è°ƒç”¨è¿™ä¸ªå·¥å‚å‡½æ•°æ¥ç”Ÿæˆè¿­ä»£å™¨ï¼Œè¿™äº›åŸç”Ÿè¯­è¨€ç»“æ„ä¼šåœ¨åå°è°ƒç”¨æä¾›çš„å¯è¿­ä»£å¯¹è±¡çš„è¿™ä¸ªå·¥å‚å‡½æ•°ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ã€‚ æ”¯æŒå¯è¿­ä»£å¯¹è±¡çš„åŸç”Ÿè¯­è¨€ç»“æ„åŒ…æ‹¬ï¼š for-of å¾ªç¯ æ•°ç»„ç»“æ„ æ‰©å±•æ“ä½œç¬¦ Array.from() åˆ›å»ºé›†åˆ åˆ›å»ºæ˜ å°„ Promise.all() å’ŒPromise.race æ¥æ”¶å¯ç”±Promiseç»„æˆçš„å¯è¿­ä»£å¯¹è±¡ yield* æ“ä½œç¬¦ï¼Œåœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨ å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112131415161718192021let arr = ['a', 'b', 'c'];for (const el of arr) { console.log(el);}let [a, b, c] = arr;console.log(a, b, c); // a b clet arr2 = [...arr];console.log(arr2); // clone of arrlet arr3 = Array.from(arr);console.log(arr3); // clone of arrlet set = new Set(arr);console.log(set); // Set(3) {size: 3, a, b, c}let pairs = arr.map((el, i) =&gt; [i, el]);let map = new Map(pairs);console.log(pairs); // [Array(2), Array(2), Array(2)]console.log(map); // Map(3) {size: 3, 0 =&gt; a, 1 =&gt; b, 2 =&gt; c} è‡ªå®šä¹‰è¿­ä»£å™¨ä¸Iterableæ¥å£ç±»ä¼¼ï¼Œä»»ä½•å®ç°äº†Iteratoræ¥å£çš„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºè¿­ä»£å™¨ä½¿ç”¨ï¼ŒSymbol.iterator å±æ€§å¼•ç”¨çš„å·¥å‚å‡½æ•°ä¼šè¿”å›ç›¸åŒçš„è¿­ä»£å™¨ã€‚ 12345678910111213141516171819202122232425262728293031323334class Counter { constructor(limit = 0) { this.count = 0; this.limit = limit; } [Symbol.iterator]() { // ä¸ºäº†è®©ä¸€ä¸ªè¿­ä»£å¯¹è±¡å¼€æºåˆ›å»ºå¤šä¸ªè¿­ä»£å™¨(æ¯”å¦‚é‡æ–°æ‰§è¡Œfor...of)ï¼Œå¿…é¡»æ¯æ¬¡åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨å°±å¯¹åº”ä¸€ä¸ªæ–°çš„è®¡æ•°å™¨ // æ‰€ä»¥éœ€è¦æŠŠè®¡æ•°å™¨å˜é‡æ”¾åˆ°é—­åŒ…ä¸­ let count = this.count; let limit = this.limit; return { next() { if (count &lt; limit) { return { value: ++count, done: false }; } else { return { done: true }; } } } }}let counter = new Counter(4);for (let c of counter) { console.log(c); if (c &gt; 2) { break; }}//1,2console.log(counter[Symbol.iterator]()); // {next: Æ’}let counter2 = new Counter(5);console.log(counter1[Symbol.iterator] === counter2[Symbol.iterator]); //true æå‰ç»ˆæ­¢è¿­ä»£å™¨å¯é€‰çš„ return() æ–¹æ³•(åªèƒ½è¿”å›: {done:true})ç”¨æˆ·æŒ‡å®šåœ¨è¿­ä»£å™¨æå‰å…³é—­æ—¶æ‰§è¡Œçš„é€»è¾‘ã€‚è€Œæ‰§è¡Œè¿­ä»£çš„ç»“æ„æƒ³è®©è¿­ä»£å™¨æå‰å…³é—­ï¼Œå¯èƒ½åŒ…æ‹¬çš„æƒ…å†µæœ‰ï¼š for-of å¾ªç¯é€šè¿‡ breakã€continueã€returnæˆ–throwæå‰é€€å‡º ç»“æ„æ“ä½œå¹¶æœªæ¶ˆè´¹æ‰€æœ‰çš„å€¼ å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class Counter { constructor(limit = 0) { this.limit = limit; } [Symbol.iterator]() { let count = 1, limit = this.limit; return { next() { if (count &lt;= limit) { return { value: count++, done: false }; } else { return { done: true }; } }, return() { console.log('Exitng early'); return { done: true }; } }; }}let counter1 = new Counter(5);for (let i of counter1) { if (i &gt; 2) { break; } console.log(i);}// 1,2 æå‰é€€å‡ºlet counter2 = new Counter(5);try { for (let i of counter2) { if (i &gt; 2) { throw new Error('Error'); } console.log(i); }} catch (e) { }// 1,2 æå‰é€€å‡ºlet counter3 = new Counter(5);let [a, b] = counter3;// 1,2 æå‰é€€å‡º å¦‚æœè¿­ä»£å™¨æ²¡æœ‰å…³é—­ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ç»§ç»­ä»ä¸Šæ¬¡ç¦»å¼€çš„åœ°æ–¹ç»§ç»­è¿­ä»£ã€‚æ•°ç»„çš„è¿­ä»£å™¨å°±æ˜¯ä¸èƒ½å…³é—­çš„ï¼š 12345678910111213let arr = [1, 2, 3, 4, 5];let iter = arr[Symbol.iterator]();for (let i of iter) { console.log(i); if (i &gt; 2) break;}//1,2,3for (let i of iter) { console.log(i);}//4,5 ç”Ÿæˆå™¨å‡½æ•°ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ã€‚æœ€åˆè°ƒç”¨æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°ä¸æ‰§è¡Œä»»ä½•ä»£ç ï¼Œè°ƒç”¨ä¹‹åä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡(Generator)ã€‚ç”Ÿæˆå™¨å¯¹è±¡å®ç°äº†Iterable æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºä»»ä½•æ¶ˆè´¹å¯è¿­ä»£å¯¹è±¡çš„åœ°æ–¹ã€‚ç”Ÿæˆå™¨çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºæ”¯æŒ yield å…³é”®å­—ï¼Œè¯¥å…³é”®å­—èƒ½å¤Ÿæš‚åœæ‰§è¡Œå‡½æ•°ã€‚ä½¿ç”¨yieldå…³é”®å­—è¿˜å¯ä»¥é€šè¿‡next() æ–¹æ³•æ¥å—è¾“å…¥å’Œäº§å‡ºçš„å€¼ã€‚å†åŠ ä¸Š*å·ä¹‹åï¼Œyield å…³é”®å­—å¯ä»¥å°†è·Ÿåœ¨å®ƒåé¢çš„å¯è¿­ä»£å¯¹è±¡åºåˆ—åŒ–ä¸ºä¸€è¿ä¸²çš„å€¼ã€‚ ğŸ“Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å‡½æ•°ã€‚æ ‡å‡†ç±»å‹çš„å‡½æ•°æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒä¸Šä¸‹æ–‡ï¼Œè€Œç”Ÿæˆå™¨çš„æ‰§è¡Œç¯å¢ƒä¸Šä¸‹æ–‡ä¼šæš‚æ—¶æŒ‚èµ·å¹¶åœ¨å°†æ¥æ¢å¤ã€‚ é€šè¿‡è¿­ä»£å™¨å¯¹è±¡æ§åˆ¶ç”Ÿæˆå™¨è¿­ä»£å™¨ç”¨äºæ§åˆ¶ç”Ÿæˆå™¨çš„æ‰§è¡Œã€‚è¿­ä»£å™¨å¯¹è±¡æš´éœ²çš„æœ€åŸºæœ¬æ¥å£æ˜¯ next() æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¼€æºç”¨æ¥å‘ç”Ÿæˆå™¨è¯·æ±‚ä¸€ä¸ªå€¼ï¼Œä»è€Œæ§åˆ¶ç”Ÿæˆå™¨ã€‚ ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œç”Ÿæˆå™¨å‡½æ•°åªä¼šåœ¨åˆæ¬¡è°ƒç”¨next() æ–¹æ³•åå¼€å§‹æ‰§è¡Œï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡ä¸€å¼€å§‹å¤„äºæš‚åœæ‰§è¡Œçš„çŠ¶æ€ã€‚è°ƒç”¨next() æ–¹æ³•ä¼šè®©ç”Ÿæˆå™¨å¼€å§‹æˆ–æ¢å¤æ‰§è¡Œï¼Œç¢°åˆ° yieldæ—¶ä¼šè¿”å›ï¼Œå¹¶é‡æ–°è¿›å…¥æš‚åœçŠ¶æ€å¹¶ä¸”å½“å‰å‡½æ•°ä½œç”¨åŸŸçš„çŠ¶æ€ä¼šè¢«ä¿ç•™ã€‚ 123456789101112131415function* generatorNum() { yield 1; yield 2;}const gen = generatorNum();console.log(gen); // generatorNum {[[GeneratorState]]: 'suspended'}console.log(gen.next()); // {value: 1, done: false}console.log(gen.next()); // {value: 2, done: false}console.log(gen);// generatorNum {[[GeneratorState]]: 'suspended'}console.log(gen.next()); // {value: undefined, done: true}console.log(gen); // generatorNum {[[GeneratorState]]: 'closed'}// ç”Ÿæˆå™¨å¯¹è±¡å®ç°äº† Iterable æ¥å£ï¼Œé»˜è®¤çš„è¿­ä»£å™¨æ˜¯è‡ªå¼•ç”¨çš„console.log(gen[Symbol.iterator]() === gen); // true ç”Ÿæˆå™¨å¯¹è±¡ä½œä¸ºå¯è¿­ä»£å¯¹è±¡å› ä¸ºç”Ÿæˆå™¨å¯¹è±¡ä¹Ÿå®ç°äº† Iterator æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨å¯è¿­ä»£å¯¹è±¡çš„è¯­æ³•ï¼š 12345678function* generatorNum() { yield 1; yield 2;}for (let i of generatorNum()) { console.log(i);} æŠŠæ‰§è¡Œæƒäº¤ç»™ä¸‹ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡yield* è¯­å¥å¯ä»¥å°†å½“å‰ç”Ÿæˆå™¨å¯¹è±¡çš„æ‰§è¡Œæƒäº¤ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚æˆ–è€…è¯´yield* è¯­å¥å¯ä»¥è¿­ä»£ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼š 123456789101112131415161718function* generatorNum() { yield 1; yield 2; // è¿”å›å€¼ä¸º cï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼åˆ™ä¸º undefined console.log(yield* generatorStr()) yield* [3, 4];}function* generatorStr() { yield 'a'; yield 'b'; return 'c';}for (let i of generatorNum()) { console.log(i);}//1,2,a,b,c,3,4 ä½¿ç”¨ç”Ÿæˆå™¨ä½¿ç”¨ç”Ÿæˆå™¨ç”ŸæˆIDåºåˆ—ä¸‹é¢çš„ä¾‹å­ä¸­è®°å½•IDçš„å˜é‡æ— æ³•åœ¨ç”Ÿæˆå™¨å¤–éƒ¨è¢«ä¿®æ”¹ï¼ŒidGenerator è¿­ä»£å™¨å¯ä»¥ä¸€ç›´å‘ç”Ÿæˆå™¨è¯·æ±‚æ–°çš„IDå€¼ã€‚ç”Ÿæˆå™¨ä¼šæŒ‰éœ€è®¡ç®—å®ƒä»¬çš„äº§ç”Ÿå€¼ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½å¤Ÿæœ‰æ•ˆçš„è¡¨ç¤ºä¸€ä¸ªè®¡ç®—æˆæœ¬å¾ˆé«˜çš„åºåˆ—ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œå¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œæ˜¯ä¸æ¨èä½¿ç”¨ while(true) å¾ªç¯çš„ï¼Œä½†æ˜¯ç”Ÿæˆå™¨å‡½æ•°å´ä¸ä¼šæœ‰é—®é¢˜ã€‚ 123456789101112function* IdGenerator() { let id = 0; while (true) { yield ++id; }}const idGenerator = IdGenerator();const id1 = idGenerator.next().value;const id2 = idGenerator.next().value;const id3 = idGenerator.next().value;console.log(id1, id2, id3);// 1,2,3 ä½¿ç”¨ yield* å®ç°é€’å½’ç®—æ³•é€šè¿‡ç”Ÿæˆå™¨çš„æ–¹å¼å®ç°çš„é€’å½’æˆ‘ä»¬å¯ä»¥ä¸å¿…ä¾èµ–å›è°ƒå‡½æ•°ï¼Œç›´æ¥åœ¨ for of ä¸­å°±å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œæ“ä½œã€‚åŒæ—¶ï¼Œä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°æ¥è§£è€¦ä»£ç ï¼Œå°†ç”Ÿäº§å€¼çš„ä»£ç (domèŠ‚ç‚¹)å’Œæ¶ˆè´¹å€¼(å¯¹domèŠ‚ç‚¹çš„æ“ä½œ)çš„ä»£ç éš”ç¦»å¼€ 12345678910111213141516171819202122232425262728293031323334353637/** * ç”Ÿæˆå™¨é€’å½’å‡½æ•° * @param {*} elelemt */function* DomTaversal(elelemt) { yield elelemt; elelemt = elelemt.firstElementChild; while (elelemt) { yield* DomTaversal(elelemt); elelemt = elelemt.nextElementSibling; }}/** * æ™®é€šé€’å½’å‡½æ•° * @param {*} elelemt * @param {*} callback */function TranversalDOM(elelemt, callback) { callback(elelemt); elelemt = elelemt.firstElementChild; while (elelemt) { TranversalDOM(elelemt, callback); elelemt = elelemt.nextElementSibling; }}const root = document.getElementById('root');TranversalDOM(root, (elelemt) =&gt; { console.log(elelemt);});for (let elelemt of DomTaversal(root)) { console.log(elelemt);} ç”Ÿæˆå™¨ä½œä¸ºé»˜è®¤è¿­ä»£å™¨å› ä¸ºç”Ÿæˆå™¨å¯¹è±¡å®ç°äº† Iterableæ¥å£ï¼Œè€Œç”Ÿæˆå™¨å‡½æ•°å’Œé»˜è®¤è¿­ä»£å™¨è¢«è°ƒç”¨ä¹‹åéƒ½äº§ç”Ÿè¿­ä»£å™¨ï¼Œæ‰€ä»¥ç”Ÿæˆå™¨ä¹Ÿå¾ˆé€‚åˆä½œä¸ºé»˜è®¤è¿­ä»£å™¨ã€‚ 123456789101112131415class Foo { constructor() { this.values = [1, 2, 3]; } *[Symbol.iterator]() { yield* this.values; }}const f = new Foo();for (const x of f) { console.log(x);} ä¸ç”Ÿæˆå™¨è¿›è¡Œäº¤äº’yieldå…³é”®å­—é™¤äº†å¯ä»¥ä½œä¸ºå‡½æ•°ä¸­é—´è¿”å›è¯­å¥ä½¿ç”¨ï¼Œyield è¿˜å¯ä»¥ä½œä¸ºå‡½æ•°çš„ä¸­é—´å‚æ•°ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´é™¤äº†å¯ä»¥é€šè¿‡yield å…³é”®å­—æ¥æ”¶ä»ç”Ÿæˆå™¨è¿”å›çš„å€¼ï¼Œè¿˜å¯ä»¥å‘ç”Ÿæˆå™¨å‘é€å€¼ï¼Œä»è€Œå®ç°åŒå‘é€šä¿¡ã€‚ ğŸ“Œç¬¬ä¸€æ¬¡è°ƒç”¨ next() ä¼ å…¥çš„å€¼ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ¬¡è°ƒç”¨æ˜¯ä¸ºäº†å¼€å§‹æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°ã€‚ 12345678910111213141516171819202122function* generatorFn(initial) { console.log(initial); // foo const result = yield `A ${initial}`; console.log(result); // baz console.log(yield `B ${initial} ${result}`); // qux}let gen = generatorFn('foo');// æ— æ³•é€šè¿‡ç¬¬ä¸€æ¬¡ next æ–¹æ³•æ¥å‘ç”Ÿæˆå™¨ä¼ é€’å€¼// ä½†æ˜¯å¯ä»¥é€šè¿‡å‘ç”Ÿæˆå™¨ä¼ é€’ä¸€ä¸ªåˆå§‹å€¼const result1 = gen.next('bar');const result2 = gen.next('baz');const result3 = gen.next('qux');console.log(result1); // {value: 'A foo', done: false}console.log(result2); // {value: 'B foo baz', done: false}console.log(result3); // {value: undefined, done: true}// foo// baz// qux// {value: 'A foo', done: false}// {value: 'B foo baz', done: false}// {value: undefined, done: true} æå‰ç»ˆæ­¢ç”Ÿæˆå™¨ä¸è¿­ä»£å™¨ç±»ä¼¼ï¼Œç”Ÿæˆå™¨ä¹Ÿæœ‰â€œå¯å…³é—­â€çš„æ¦‚å¿µã€‚åœ¨ç”Ÿæˆå™¨ä¸­return() å’Œ throw() æ–¹æ³•éƒ½å¯ä»¥ç”¨äºå¼ºåˆ¶ç”Ÿæˆå™¨è¿›å…¥å…³é—­çŠ¶æ€ã€‚ ğŸ“Œä¸åŒæ ·å®ç°äº† Iterableæ¥å£çš„è¿­ä»£å™¨å¯¹è±¡ç›¸æ¯”ï¼šè¿­ä»£å™¨çš„return()æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œä¼šåœ¨æå‰ç»ˆæ­¢è¿­ä»£å™¨æ—¶è¢«æ‰§è¡Œã€‚è€Œç”Ÿæˆå™¨çš„å¯¹è±¡éƒ½æœ‰return()æ–¹æ³•ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡å®ƒå°†ç”Ÿæˆå™¨å¯¹è±¡è¿›å…¥å…³é—­çŠ¶æ€ã€‚ return()æ–¹æ³•return() æ–¹æ³•ä¼šå¼ºåˆ¶ç”Ÿæˆå™¨è¿›å…¥å…³é—­çŠ¶æ€ã€‚æä¾›ç»™ return() æ–¹æ³•çš„å€¼å°±æ˜¯ç»ˆæ­¢è¿­ä»£å™¨å¯¹è±¡çš„å€¼ã€‚ 12345678910111213141516171819202122function* generatorFn() { yield* [1, 2, 3];}const g = generatorFn();console.log(g); // generatorFn {[[GeneratorState]]: 'suspended'}// æ”¯æŒè¿­ä»£çš„è¯­è¨€ç»“æ„ä¼šå¿½ç•¥çŠ¶æ€ä¸ºï¼šdone:true çš„ IteratorResult å†…éƒ¨è¿”å›çš„å€¼console.log(g.return(4)); // {value: 4, done: true}console.log(g); // generatorFn {[[GeneratorState]]: 'closed'}const g2 = generatorFn();for (let x of g2) { if (x &gt; 1) { // break ä¹Ÿå¯ä»¥ç»ˆæ­¢è¿­ä»£ g2.return(4); } console.log(x);}// 1ï¼Œ2console.log(g2); // generatorFn {[[GeneratorState]]: 'closed'}console.log(g2.next()); // {value: undefined, done: true} throw() æ–¹æ³•throw() æ–¹æ³•ä¼šåœ¨æš‚åœçš„æ—¶å€™å°†ä¸€ä¸ªæä¾›çš„é”™è¯¯æ³¨å…¥åˆ°ç”Ÿæˆå™¨å¯¹è±¡ä¸­ã€‚å¦‚æœé”™è¯¯æœªè¢«å¤„ç†ï¼Œç”Ÿæˆå™¨å°±ä¼šå…³é—­ã€‚ 123456789101112function* generatorFn() { yield* [1, 2, 3];}const g = generatorFn();console.log(g); // generatorFn {[[GeneratorState]]: 'suspended'}try { g.throw('error');} catch (e) { console.log(e) // error}console.log(g); // generatorFn {[[GeneratorState]]: 'closed'} å¦‚æœç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨å¤„ç†äº†è¿™ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨å°±ä¸ä¼šå…³é—­ï¼Œè€Œä¸”è¿˜å¯ä»¥æ¢å¤æ‰§è¡Œã€‚é”™è¯¯å¤„ç†ä¼šè·³è¿‡å¯¹åº”çš„ yieldï¼Œå¦‚ä¸‹ï¼š 123456789101112131415function* generatorFn() { for (const x of [1, 2, 3]) { try { yield x; } catch (e) { } }}const g = generatorFn();console.log(g); // generatorFn {[[GeneratorState]]: 'suspended'}// è¦å…ˆæ‰§è¡Œï¼Œåé¢æ‰èƒ½æ•è·é”™è¯¯console.log(g.next()); // {value: 1, done: false}g.throw('error');console.log(g.next()); // {value: 3, done: false}console.log(g); // generatorFn {[[GeneratorState]]: 'closed'} ğŸ“Œæ³¨æ„ï¼šå¦‚æœç”Ÿæˆå™¨è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œå°±è°ƒç”¨ throw() æŠ›å‡ºé”™è¯¯ä¸ä¼šåœ¨å‡½æ•°å†…éƒ¨è¢«æ•è·ï¼Œå› ä¸ºè¿™ç›¸å½“äºåœ¨å‡½æ•°å—å¤–éƒ¨æŠ›å‡ºäº†é”™è¯¯ã€‚ å‚è€ƒ https://zh.wikipedia.org/wiki/è¿­ä»£å™¨ https://zh.wikipedia.org/wiki/ç”Ÿæˆå™¨ è¿­ä»£åè®® - JavaScript | MDN JavaScript æ‚Ÿé“ (è±†ç“£) JavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ (è±†ç“£) JavaScriptå¿è€…ç§˜ç±ï¼ˆç¬¬2ç‰ˆï¼‰ (è±†ç“£)","link":"/2020/07/13/%E8%BF%AD%E4%BB%A3%E5%99%A8(Iterators)%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8(Generator)/"}],"tags":[{"name":"js","slug":"js","link":"/tags/js/"},{"name":"async","slug":"async","link":"/tags/async/"},{"name":"await","slug":"await","link":"/tags/await/"},{"name":"Iterator","slug":"Iterator","link":"/tags/Iterator/"},{"name":"Generator","slug":"Generator","link":"/tags/Generator/"}],"categories":[{"name":"JavaScript","slug":"JavaScript","link":"/categories/JavaScript/"}],"pages":[{"title":"","text":"Programmer","link":"/about/index.html"}]}